# Railway Configuration
# PostgreSQL-only production setup
# Frontend is deployed separately on Vercel

[build]
builder = "nixpacks"
watchPatterns = ["chat-server/**"]
# Explicitly use npm, not pnpm
buildCommand = "cd chat-server && npm install --legacy-peer-deps"

[deploy]
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10
healthcheckPath = "/health"
healthcheckTimeout = 300
startCommand = "cd chat-server && node server.js"

# IMPORTANT: DATABASE_URL MUST BE SET
# 1. Add a PostgreSQL service in Railway dashboard
# 2. In your app's Variables, add: DATABASE_URL=${{Postgres.DATABASE_URL}}
# This links your app to the PostgreSQL service
#
# The server will NOT start without DATABASE_URL - it will exit with code 1
#
# Frontend is deployed on Vercel
#
# IMPORTANT: Set Root Directory in Railway Dashboard to "chat-server"
# This prevents pnpm auto-detection at the root level
